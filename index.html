<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="theme-color" content="#0891b2">
    
    <title>Zahngut Bad Wünnenberg</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0891b2;
            --primary-dark: #0e7490;
            --accent: #06b6d4;
            --secondary: #3bc4e5;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --text-dark: #0F172A;
            --text-light: #64748B;
            --bg-light: #F8FAFC;
            --white: #FFFFFF;
            --shadow: 0 2px 15px rgba(8,145,178,0.08);
            --radius: 16px;
            --gradient: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text-dark);
            background: var(--bg-light);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 70px;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hide {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            margin-bottom: 20px;
            animation: pulse 1.5s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 30px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Firebase Status */
        .firebase-status {
            position: fixed;
            bottom: 80px;
            right: 10px;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            z-index: 100;
            display: none;
            align-items: center;
            gap: 5px;
        }

        .firebase-status.show {
            display: flex;
        }

        .firebase-status.offline {
            background: rgba(239, 68, 68, 0.9);
        }

        /* Header */
        .header {
            background: var(--gradient);
            color: var(--white);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 24px rgba(8,145,178,0.15);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .emergency-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            color: var(--white);
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
        }

        /* Hero Section */
        .hero {
            padding: 30px 20px;
            background: linear-gradient(180deg, rgba(8,145,178,0.05) 0%, transparent 100%);
        }

        .hero h1 {
            font-size: 28px;
            margin-bottom: 12px;
            color: var(--text-dark);
            font-weight: 800;
        }

        .hero p {
            color: var(--text-light);
            font-size: 16px;
            line-height: 1.5;
        }

        /* Quick Actions */
        .quick-actions {
            padding: 0 20px 30px;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .action-card {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 15px rgba(8,145,178,0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(8,145,178,0.1);
        }

        .action-card:active {
            transform: scale(0.95);
        }

        .action-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .action-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s ease;
            min-height: calc(100vh - 200px);
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        /* Behandlungen Grid */
        .behandlungen-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .behandlung-card {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 15px rgba(8,145,178,0.08);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .behandlung-card:active {
            transform: scale(0.95);
        }

        .behandlung-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .behandlung-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Video Cards */
        .video-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .video-card {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(8,145,178,0.08);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-card:active {
            transform: scale(0.98);
        }

        .video-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .video-info {
            display: flex;
            gap: 15px;
            color: var(--text-light);
            font-size: 13px;
        }

        /* Öffnungszeiten */
        .opening-hours {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(8,145,178,0.08);
            margin-bottom: 20px;
        }

        .hours-grid {
            display: grid;
            gap: 10px;
        }

        .hours-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 20px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .hours-row:last-child {
            border-bottom: none;
        }

        .day {
            font-weight: 600;
            color: var(--text-dark);
        }

        .time {
            color: var(--text-light);
        }

        /* Nachsorge */
        .nachsorge-card {
            background: var(--white);
            border-radius: 16px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 2px 15px rgba(8,145,178,0.08);
            transition: all 0.3s ease;
        }

        .nachsorge-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
        }

        .nachsorge-icon {
            font-size: 36px;
            width: 50px;
            height: 50px;
            background: rgba(8,145,178,0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nachsorge-info {
            flex: 1;
        }

        .nachsorge-info h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .nachsorge-info p {
            font-size: 13px;
            color: var(--text-light);
        }

        .nachsorge-content {
            display: none;
            padding: 0 20px 20px;
        }

        .nachsorge-card.expanded .nachsorge-content {
            display: block;
        }

        .timeline-item {
            padding: 15px 0;
            border-left: 2px solid var(--primary);
            margin-left: 10px;
            padding-left: 20px;
        }

        .timeline-item h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .timeline-item ul {
            margin-left: 15px;
            color: var(--text-light);
            font-size: 13px;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            font-size: 13px;
        }

        /* Contact Info */
        .contact-card {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 15px rgba(8,145,178,0.08);
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .contact-item:last-child {
            border-bottom: none;
        }

        .contact-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }

        .contact-info {
            flex: 1;
        }

        .contact-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .contact-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Emergency Section */
        .emergency-card {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }

        .emergency-number {
            font-size: 28px;
            font-weight: 700;
            margin: 15px 0;
        }

        .emergency-tips {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
        }

        .emergency-tips h3 {
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .emergency-tips ul {
            margin-left: 20px;
            color: var(--text-light);
            line-height: 1.8;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(8,145,178,0.1);
            padding: 8px 0;
            display: flex;
            justify-content: space-around;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(8,145,178,0.08);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-item-label {
            font-size: 11px;
            font-weight: 600;
        }

        /* Back Button */
        .back-button {
            background: var(--white);
            border: 1px solid rgba(8,145,178,0.2);
            padding: 10px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
        }

        /* Detail Views */
        .detail-header {
            background: var(--gradient);
            color: white;
            padding: 30px 20px;
            margin: -20px -20px 20px;
            text-align: center;
        }

        .detail-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .detail-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .detail-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .detail-section {
            background: var(--white);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 15px rgba(8,145,178,0.08);
        }

        .detail-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .detail-section ul {
            margin-left: 20px;
            color: var(--text-light);
            line-height: 1.8;
        }

        .detail-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .detail-info-item {
            background: rgba(8,145,178,0.05);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .detail-info-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .detail-info-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Doctolib Button */
        .doctolib-btn {
            background: linear-gradient(135deg, #00d4ff 0%, #0099ff 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0,153,255,0.3);
        }

        /* Category Badges */
        .category-badge {
            display: inline-block;
            background: rgba(8,145,178,0.1);
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">🦷</div>
        <div class="loading-text">Zahngut Bad Wünnenberg</div>
        <div class="loading-spinner"></div>
    </div>

    <!-- Firebase Status -->
    <div class="firebase-status" id="firebaseStatus">
        <span id="firebaseStatusText">Offline</span>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">🦷</span>
                <span class="praxis-name">Zahngut Bad Wünnenberg</span>
            </div>
            <a href="tel:01805986700" class="emergency-btn">
                📞 Notfall
            </a>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="mainContent">
        <!-- Home Section -->
        <div id="home" class="content-section active">
            <!-- Hero -->
            <div class="hero">
                <h1>Willkommen bei Zahngut</h1>
                <p class="hero-slogan">Moderne Zahnmedizin. Der Mensch im Mittelpunkt.</p>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h2 class="section-title">Schnellzugriff</h2>
                <div class="action-grid">
                    <div class="action-card" onclick="switchTab('termine')">
                        <div class="action-icon">📅</div>
                        <div class="action-title">Termin buchen</div>
                    </div>
                    <div class="action-card" onclick="switchTab('notfall')">
                        <div class="action-icon">🚨</div>
                        <div class="action-title">Notdienst</div>
                    </div>
                    <div class="action-card" onclick="switchTab('behandlungen')">
                        <div class="action-icon">🦷</div>
                        <div class="action-title">Behandlungen</div>
                    </div>
                    <div class="action-card" onclick="switchTab('videos')">
                        <div class="action-icon">🎥</div>
                        <div class="action-title">Videos</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Videos Section -->
        <div id="videos" class="content-section">
            <h2 class="section-title">Aufklärungsvideos</h2>
            <div class="video-grid" id="videosList">
                <!-- Videos werden hier eingefügt -->
            </div>
        </div>

        <!-- Behandlungen Section -->
        <div id="behandlungen" class="content-section">
            <h2 class="section-title">Unsere Behandlungen</h2>
            <div class="behandlungen-grid" id="behandlungenGrid">
                <!-- Behandlungen werden hier eingefügt -->
            </div>
        </div>

        <!-- Behandlung Detail -->
        <div id="behandlungDetail" class="content-section">
            <div class="back-button" onclick="switchTab('behandlungen')">
                ← Zurück
            </div>
            <div id="behandlungDetailContent">
                <!-- Detail content wird hier eingefügt -->
            </div>
        </div>

        <!-- Nachsorge Section -->
        <div id="nachsorge" class="content-section">
            <h2 class="section-title">Nachsorge-Tipps</h2>
            <div id="nachsorgeList">
                <!-- Nachsorge items werden hier eingefügt -->
            </div>
        </div>

        <!-- Termine Section -->
        <div id="termine" class="content-section">
            <h2 class="section-title">Termine & Kontakt</h2>
            
            <!-- Öffnungszeiten -->
            <div class="opening-hours">
                <h3>Öffnungszeiten</h3>
                <div class="hours-grid" id="openingHours">
                    <!-- Öffnungszeiten werden hier eingefügt -->
                </div>
            </div>

            <!-- Kontakt -->
            <div class="contact-card">
                <div class="contact-item" onclick="window.location.href='tel:02957/1010'">
                    <div class="contact-icon">📞</div>
                    <div class="contact-info">
                        <div class="contact-label">Telefon</div>
                        <div class="contact-value" id="phoneNumber">02957/1010</div>
                    </div>
                </div>
                <div class="contact-item" onclick="window.location.href='mailto:info@dein-zahngut.de'">
                    <div class="contact-icon">✉️</div>
                    <div class="contact-info">
                        <div class="contact-label">E-Mail</div>
                        <div class="contact-value" id="emailAddress">info@dein-zahngut.de</div>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="contact-icon">📍</div>
                    <div class="contact-info">
                        <div class="contact-label">Adresse</div>
                        <div class="contact-value" id="praxisAddress">
                            Hauptstraße 1<br>
                            33181 Bad Wünnenberg
                        </div>
                    </div>
                </div>
            </div>

            <!-- Doctolib Button -->
            <a href="https://www.doctolib.de/zahnarztpraxis/bad-wuennenberg/zahngut-bad-wuennenberg" 
               class="doctolib-btn" target="_blank" id="doctolibLink">
                📅 Online Termin buchen
            </a>
        </div>

        <!-- Notfall Section -->
        <div id="notfall" class="content-section">
            <div class="emergency-card">
                <h2 style="color: white; margin-bottom: 10px;">Zahnärztlicher Notdienst</h2>
                <div class="emergency-number" id="emergencyNumber">01805 / 986 700</div>
                <p style="font-size: 14px;">Außerhalb der Öffnungszeiten</p>
            </div>

            <div class="emergency-tips">
                <h3>Erste Hilfe bei Zahnschmerzen</h3>
                <ul id="emergencyInstructions">
                    <li>Kühlen Sie die betroffene Stelle von außen</li>
                    <li>Spülen Sie mit lauwarmem Salzwasser</li>
                    <li>Nehmen Sie bei Bedarf Schmerzmittel (Ibuprofen)</li>
                    <li>Vermeiden Sie Wärme und körperliche Anstrengung</li>
                </ul>
            </div>

            <div class="emergency-tips">
                <h3>Bei Zahnverlust</h3>
                <p id="toothOutInstructions">Zahn nur an der Krone anfassen, in H-Milch oder Kochsalzlösung legen, sofort zum Zahnarzt!</p>
            </div>

            <div class="emergency-tips">
                <h3>Bei gelockertem Zahn</h3>
                <p id="toothLooseInstructions">Nicht bewegen, weiche Kost, schnellstmöglich zum Zahnarzt</p>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home')">
            <div class="nav-item-icon">🏠</div>
            <div class="nav-item-label">Start</div>
        </div>
        <div class="nav-item" onclick="switchTab('behandlungen')">
            <div class="nav-item-icon">🦷</div>
            <div class="nav-item-label">Behandlung</div>
        </div>
        <div class="nav-item" onclick="switchTab('videos')">
            <div class="nav-item-icon">🎥</div>
            <div class="nav-item-label">Videos</div>
        </div>
        <div class="nav-item" onclick="switchTab('nachsorge')">
            <div class="nav-item-icon">💊</div>
            <div class="nav-item-label">Nachsorge</div>
        </div>
        <div class="nav-item" onclick="switchTab('termine')">
            <div class="nav-item-icon">📅</div>
            <div class="nav-item-label">Termine</div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <!-- App Scripts -->
    <script src="firebase-config.js"></script>
    <script src="firebase-service.js"></script>
    <script src="data.js"></script>

    <script>
        // App State
        let appData = null;
        let currentView = 'home';

        // Navigation
        function switchTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const activeSection = document.getElementById(tabName);
            if (activeSection) {
                activeSection.classList.add('active');
            }
            
            // Update nav if main tab
            const mainTabs = ['home', 'behandlungen', 'videos', 'nachsorge', 'termine'];
            if (mainTabs.includes(tabName)) {
                document.querySelectorAll('.nav-item').forEach((item, index) => {
                    item.classList.remove('active');
                    if ((tabName === 'home' && index === 0) ||
                        (tabName === 'behandlungen' && index === 1) ||
                        (tabName === 'videos' && index === 2) ||
                        (tabName === 'nachsorge' && index === 3) ||
                        (tabName === 'termine' && index === 4)) {
                        item.classList.add('active');
                    }
                });
            }
            
            currentView = tabName;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show Behandlung Detail
        function showBehandlungDetail(behandlungId) {
            const behandlung = appData.treatments.find(b => b.id === behandlungId);
            if (!behandlung) return;

            const content = document.getElementById('behandlungDetailContent');
            content.innerHTML = `
                <div class="detail-header">
                    <div class="detail-icon">${behandlung.icon || '🦷'}</div>
                    <div class="detail-title">${behandlung.name}</div>
                    <div class="detail-subtitle">${behandlung.untertitel || ''}</div>
                </div>

                <div class="detail-section">
                    <h3>Was ist das?</h3>
                    <p>${behandlung.was || 'Keine Beschreibung verfügbar'}</p>
                </div>

                ${behandlung.ablauf ? `
                    <div class="detail-section">
                        <h3>Behandlungsablauf</h3>
                        <ul>
                            ${behandlung.ablauf.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}

                ${behandlung.vorteile ? `
                    <div class="detail-section">
                        <h3>Ihre Vorteile</h3>
                        <ul>
                            ${behandlung.vorteile.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}

                <div class="detail-info">
                    ${behandlung.dauer ? `
                        <div class="detail-info-item">
                            <div class="detail-info-label">Dauer</div>
                            <div class="detail-info-value">${behandlung.dauer}</div>
                        </div>
                    ` : ''}
                    ${behandlung.empfohlen ? `
                        <div class="detail-info-item">
                            <div class="detail-info-label">Empfohlen</div>
                            <div class="detail-info-value">${behandlung.empfohlen}</div>
                        </div>
                    ` : ''}
                </div>
            `;

            switchTab('behandlungDetail');
        }

        // Toggle Nachsorge
        function toggleNachsorge(element) {
            element.classList.toggle('expanded');
        }

        // Firebase Connection Monitor
        function setupFirebaseMonitoring() {
            if (typeof firebase !== 'undefined' && firebase.database) {
                const connectedRef = firebase.database().ref('.info/connected');
                connectedRef.on('value', (snap) => {
                    const status = document.getElementById('firebaseStatus');
                    const statusText = document.getElementById('firebaseStatusText');
                    
                    if (snap.val() === true) {
                        status.classList.remove('offline');
                        statusText.textContent = '🟢 Online';
                        status.classList.add('show');
                        
                        // Hide after 3 seconds
                        setTimeout(() => {
                            status.classList.remove('show');
                        }, 3000);
                    } else {
                        status.classList.add('offline');
                        statusText.textContent = '🔴 Offline';
                        status.classList.add('show');
                    }
                });
            }
        }

        // Load Data
        async function loadAppData() {
            try {
                let data = null;
                
                // Try Firebase first
                if (typeof FirebaseService !== 'undefined') {
                    console.log('Attempting to load from Firebase...');
                    try {
                        data = await FirebaseService.getAllAppData();
                        if (data && data.praxis) {
                            console.log('✅ Data loaded from Firebase');
                        }
                    } catch (firebaseError) {
                        console.warn('Firebase load failed:', firebaseError);
                    }
                }
                
                // Fallback to localStorage
                if (!data || !data.praxis) {
                    console.log('Attempting to load from localStorage...');
                    const stored = localStorage.getItem('zahngutAppData');
                    if (stored) {
                        data = JSON.parse(stored);
                        console.log('✅ Data loaded from localStorage');
                    }
                }
                
                // Fallback to default data
                if (!data || !data.praxis) {
                    console.log('Loading default data...');
                    if (typeof ZahngutData !== 'undefined' && ZahngutData.defaultData) {
                        data = ZahngutData.defaultData;
                        console.log('✅ Default data loaded');
                    }
                }
                
                if (data) {
                    appData = data;
                    renderApp();
                } else {
                    console.error('No data available');
                    showError();
                }
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError();
            }
        }

        // Render App
        function renderApp() {
            if (!appData) return;

            // Update header
            if (appData.praxis) {
                document.querySelector('.praxis-name').textContent = appData.praxis.name || 'Zahngut Bad Wünnenberg';
                document.querySelector('.hero h1').textContent = 'Willkommen bei ' + (appData.praxis.name || 'Zahngut');
                document.querySelector('.hero-slogan').textContent = appData.praxis.slogan || '';
            }

            // Render Behandlungen
            renderBehandlungen();

            // Render Videos
            renderVideos();

            // Render Nachsorge
            renderNachsorge();

            // Render Opening Hours
            renderOpeningHours();

            // Render Contact Info
            renderContactInfo();

            // Render Emergency Info
            renderEmergencyInfo();
        }

        // Render Behandlungen
        function renderBehandlungen() {
            const grid = document.getElementById('behandlungenGrid');
            if (!appData.treatments || appData.treatments.length === 0) {
                grid.innerHTML = '<p>Keine Behandlungen verfügbar</p>';
                return;
            }

            grid.innerHTML = appData.treatments
                .filter(b => b.active !== false)
                .map(behandlung => `
                    <div class="behandlung-card" onclick="showBehandlungDetail('${behandlung.id}')">
                        <div class="behandlung-icon">${behandlung.icon || '🦷'}</div>
                        <div class="behandlung-name">${behandlung.name}</div>
                    </div>
                `).join('');
        }

        // Render Videos
        function renderVideos() {
            const container = document.getElementById('videosList');
            if (!appData.videos || appData.videos.length === 0) {
                container.innerHTML = '<p>Keine Videos verfügbar</p>';
                return;
            }

            container.innerHTML = appData.videos
                .filter(v => v.active !== false)
                .map(video => `
                    <div class="video-card" onclick="window.open('${video.url}', '_blank')">
                        <div class="video-title">${video.title}</div>
                        <div class="video-info">
                            <span>⏱ ${video.duration || 'N/A'}</span>
                            <span>👁 ${video.views || '0'} Aufrufe</span>
                        </div>
                    </div>
                `).join('');
        }

        // Render Nachsorge
        function renderNachsorge() {
            const container = document.getElementById('nachsorgeList');
            if (!appData.aftercare || appData.aftercare.length === 0) {
                container.innerHTML = '<p>Keine Nachsorge-Tipps verfügbar</p>';
                return;
            }

            container.innerHTML = appData.aftercare
                .filter(n => n.active !== false)
                .map(item => `
                    <div class="nachsorge-card" onclick="toggleNachsorge(this)">
                        <div class="nachsorge-header">
                            <div class="nachsorge-icon">${item.icon || '🦷'}</div>
                            <div class="nachsorge-info">
                                <h3>${item.behandlung}</h3>
                                <p>${item.kurzbeschreibung}</p>
                            </div>
                        </div>
                        <div class="nachsorge-content">
                            <div class="timeline">
                                ${Object.values(item.phasen || {}).map(phase => `
                                    <div class="timeline-item">
                                        <h4>${phase.title} (${phase.time})</h4>
                                        <ul>
                                            ${phase.items.map(i => `<li>${i}</li>`).join('')}
                                        </ul>
                                    </div>
                                `).join('')}
                            </div>
                            ${item.warnung ? `
                                <div class="warning-box">
                                    <strong>⚠️ Sofort melden bei:</strong> ${item.warnung}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
        }

        // Render Opening Hours
        function renderOpeningHours() {
            const container = document.getElementById('openingHours');
            if (!appData.oeffnungszeiten) {
                container.innerHTML = '<p>Öffnungszeiten nicht verfügbar</p>';
                return;
            }

            const days = ['montag', 'dienstag', 'mittwoch', 'donnerstag', 'freitag', 'samstag', 'sonntag'];
            const dayNames = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'];

            container.innerHTML = days.map((day, index) => {
                const hours = appData.oeffnungszeiten[day];
                const timeText = hours && hours.von && hours.bis 
                    ? `${hours.von} - ${hours.bis} Uhr`
                    : 'Geschlossen';
                
                return `
                    <div class="hours-row">
                        <div class="day">${dayNames[index]}</div>
                        <div class="time">${timeText}</div>
                    </div>
                `;
            }).join('');
        }

        // Render Contact Info
        function renderContactInfo() {
            if (appData.praxis) {
                document.getElementById('phoneNumber').textContent = appData.praxis.telefon || '02957/1010';
                document.getElementById('emailAddress').textContent = appData.praxis.email || 'info@dein-zahngut.de';
                
                const address = appData.praxis.address || appData.praxis;
                document.getElementById('praxisAddress').innerHTML = `
                    ${address.street || 'Hauptstraße 1'}<br>
                    ${address.zip || '33181'} ${address.city || 'Bad Wünnenberg'}
                `;

                if (appData.praxis.doctolib) {
                    document.getElementById('doctolibLink').href = appData.praxis.doctolib;
                }
            }
        }

        // Render Emergency Info
        function renderEmergencyInfo() {
            if (appData.emergency) {
                document.getElementById('emergencyNumber').textContent = appData.emergency.nummer || '01805 / 986 700';
                
                if (appData.emergency.anweisungen) {
                    document.getElementById('emergencyInstructions').innerHTML = 
                        appData.emergency.anweisungen.map(a => `<li>${a}</li>`).join('');
                }

                if (appData.emergency.zahnAus) {
                    document.getElementById('toothOutInstructions').textContent = appData.emergency.zahnAus;
                }

                if (appData.emergency.zahnLocker) {
                    document.getElementById('toothLooseInstructions').textContent = appData.emergency.zahnLocker;
                }
            }
        }

        // Show Error
        function showError() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div style="padding: 40px; text-align: center;">
                    <h2 style="color: var(--error);">Fehler beim Laden</h2>
                    <p style="margin-top: 20px; color: var(--text-light);">
                        Die App-Daten konnten nicht geladen werden.<br>
                        Bitte prüfen Sie Ihre Internetverbindung.
                    </p>
                    <button onclick="location.reload()" style="
                        margin-top: 30px;
                        padding: 12px 24px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 16px;
                        cursor: pointer;
                    ">Neu laden</button>
                </div>
            `;
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }

        // Initialize App
        window.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Initializing Zahngut App...');
            
            // Setup Firebase monitoring
            setupFirebaseMonitoring();
            
            // Load data
            await loadAppData();
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hide');
            }, 1000);
        });

        // Prevent double-tap zoom on iOS
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
